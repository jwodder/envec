NOTES ON SCRAPING SPOILERS FROM GATHERER

NOTE: Gatherer changed the format of the individual card details pages for
flipped cards on or around 17 Nov, along with the "Other Sets" fields on all
card details pages (and possibly other things); the notes below need to be
updated appropriately.

- So far, every split card has been homogeneously typed (i.e., always either
  Instant // Instant or Sorcery // Sorcery).
- The entries for the flipped portions of flipped cards (when they're separate
  entries in the first place) list the mana costs of the non-flipped portions
  (in accordance with the rules for flipped cards).
- Don't try to find patterns in the assignment of multiverseids; there are too
  many gaps, temporary jumps backwards, and other discontinuities for it to
  make sense.
- The different faces of double-faced cards have separate multiverseids, even
  though they lead to the same page!

- On the checklist output format:
 - When searching by a single set:
  - Each card link uses the multiverseid of the card's printing in that set.
  - A card that had multiple versions printed in the set (usually basic lands)
    will use the same multiverseid for all of its card links, though how the id
    is selected is unknown.
  - Each half of a split card is listed twice (only for the Invasion block?)
    and has the name of only that half.
  - Each half of a flip or double-faced card is listed separately and has the
    name of only that half.
 - When not searching by set, each card link uses the multiverseid of the
   latest printing.
 - The data is contained in a table of class "checklist".  Each card is
   represented as a <tr class="cardItem"> containing <td>s with the following
   classes:
  - number - collector's number; potentially empty
  - name - contains hyperlinked name (<a class="nameLink">)
  - artist
  - color - slash-separated list
  - rarity - L, C, U, R, or M
  - set
 - The problems with the names of Valor, Call of the Herd, Ærathi Berserker,
   Altar of Dementia, and Knight of Dawn do not occur with the checklist output
   format.

- On the text spoiler output format:
 - The names of split cards are given in the form "$left // $right ($this)"
 - The names of the bottom halves of flip cards are given in the form "$top
   ($bottom)"

- On the individual card details pages:
 - For a single-part card:
  - The data is contained in a <td> with the id
    "ctl00_ctl00_ctl00_MainContent_SubContent_SubContent_rightCol", which in
    turn contains three <div>s, all with class "smallGreyMono".  The second
    <div> contains a series of <div>s with unique ids and class="row", with
    each sub-<div> containing two more <div>s with the classes "label" and
    "value", in that order.  The possible rows that can appear are:


id="ctl00_ctl00_ctl00_MainContent_SubContent_SubContent_nameRow"
trim(label) = Card Name:

id="ctl00_ctl00_ctl00_MainContent_SubContent_SubContent_manaRow"
trim(label) = Mana Cost:

id="ctl00_ctl00_ctl00_MainContent_SubContent_SubContent_cmcRow"
trim(label) = Converted Mana Cost:
 - The value may contain extra trailing <br/>s.

id="ctl00_ctl00_ctl00_MainContent_SubContent_SubContent_typeRow"
trim(label) = Types:
 - As printed on the card (e.g., "Creature  — Elf Druid"); calling &simplify
   will be necessary.

id="ctl00_ctl00_ctl00_MainContent_SubContent_SubContent_textRow"
trim(label) = Card Text:
 - The "value" div contains a series of <div class="cardtextbox">s, each
   representing one line of the card's rules text.

id="ctl00_ctl00_ctl00_MainContent_SubContent_SubContent_flavorRow"
trim(label) = Flavor Text:
 - The "value" div contains a series of <div class="cardtextbox">s, each
   representing one line of the flavor text (though there isn't always a direct
   correspondence between printed lines and cardtextboxes).  Indentation of
   "citation" lines at the end of flavor text does not seem to be preserved.

id="ctl00_ctl00_ctl00_MainContent_SubContent_SubContent_markRow"
trim(label) = Watermark:
 - The value div uses cardtextboxes for some reason.

id="ctl00_ctl00_ctl00_MainContent_SubContent_SubContent_colorIndicatorRow"
trim(label) = Color Indicator:

id="ctl00_ctl00_ctl00_MainContent_SubContent_SubContent_ptRow"
trim(label) = P/T:

id="ctl00_ctl00_ctl00_MainContent_SubContent_SubContent_ptRow"
trim(label) = Loyalty:

id="ctl00_ctl00_ctl00_MainContent_SubContent_SubContent_ptRow"
trim(label) = Hand/Life:
 - example value (trimmed): "(Hand Modifier: +0 , Life Modifier: +5)"

id="ctl00_ctl00_ctl00_MainContent_SubContent_SubContent_setRow"
trim(label) = Expansion:
 - The value is a <div> with
   id="ctl00_ctl00_ctl00_MainContent_SubContent_SubContent_currentSetSymbol"
   that contains two hyperlinks, the first being the expansion symbol (linking
   to the current page) and the second the name of the expansion (linking to
   the standard spoilers for that expansion).

id="ctl00_ctl00_ctl00_MainContent_SubContent_SubContent_rarityRow"
trim(label) = Rarity:
 - The value is a <span> whose class corresponds to the rarity ("common",
   "mythic", etc.) and which contains the rarity.

id="ctl00_ctl00_ctl00_MainContent_SubContent_SubContent_otherSetsRow"
trim(label) = Other Sets:
 - The value is a <div> with
   id="ctl00_ctl00_ctl00_MainContent_SubContent_SubContent_otherSetsValue"
   that contains a series of expansion symbol images, each a hyperlink to the
   card's page for its printing in the corresponding set.

id="ctl00_ctl00_ctl00_MainContent_SubContent_SubContent_numberRow"
trim(label) = Card #:

id="ctl00_ctl00_ctl00_MainContent_SubContent_SubContent_artistRow"
trim(label) = Artist:
 - The value is a <div> with
   id="ctl00_ctl00_ctl00_MainContent_SubContent_SubContent_ArtistCredit"
   containing the name of the artist hyperlinked to a Gatherer search for eir
   other work.

   - Practically all of the "value" fields will need to be trimmed.

  - Rulings are stored in a <div> with
    id="ctl00_ctl00_ctl00_MainContent_SubContent_SubContent_rulingsContainer",
    which contains a <table> in which each <tr> (representing a ruling)
    contains two <td>s, the first containing the date of the ruling and the
    second containing the text of the ruling.  Cards which have no rulings do
    not seem to have this <div>.

  - For double-faced cards, all of the relevant IDs for the front face
    (including the IDs of the containing <td>s and rulings blocks) insert
    "ctl05_" before the last "word", and the IDs for the back face insert
    "ctl06_" before the last word.  A parser can test whether a card is
    double-faced by first checking for the existence of, e.g.,
    "ctl00_ctl00_ctl00_MainContent_SubContent_SubContent_nameRow", and iff no
    such element is found, the card is double-faced.
   - Note that each face of a double-faced card is given its own collector's
     number (both in the Oracle DB and on the printed card), with the front's
     number ending in 'a' and the back's ending in 'b'.  (However, this suffix
     is absent in the checklist output format.)


- Problems with the spoilers, (mostly) regardless of format:
 - In all formats other than the individual card details pages, entries for the
   faces of double-faced cards don't give the name of the other face.
 - Some flip cards are represented by two entries (with the flipped one being
   named "$originalName ($flippedName)"), while others are represented by a
   single entry in which the rules text for the main card is followed by a line
   of four dashes and then all of the text for the flipped card
 - The rules text of basic lands is just the letter of their mana.
 - The "{10}" in the rules text of Draco and the "{20}" in the rules text of
   Spawnsire of Ulamog are represented in the text spoilers as "{1}0}" and
   "{2}0}", respectively, with analogous mixing of mana symbols and "0}" in the
   standard & individual spoilers.
 - Some (all?) Unglued cards (and Who/What/When/Where/Why in Unhinged) encode
   mana & tap symbols in rules text incorrectly.  Erroneous symbols include:
  - ocT - {T}
  - oW - {W}
  - oU - {U}
  - oB - {B}
  - oR - {R}
  - oG - {G}
  - o2 - {2}
  - o4 - {4}
  - o7 - {7}
  - Consecutive botched mana symbols can even be run together without
    intervening spaces.
 - Rules text that is italicized in print (e.g., ability words, "Sarpadian
   Empires, Vol. VII", il- and en- creatures) is not italicized in the
   spoilers.
 - Certain tokens are listed in Gatherer for no good reason (see
   data/tokens.txt), and their card numbers overlap with those of the real
   cards in their sets.

 - Figure of Destiny
 - Rhys the Redeemed
 - Rune-Cervin Rider
 - Crackleburr
 - Creakwood Ghoul
 - Evershrike
 - Mindwrack Lieg
 - Mirror Sheen
 - Restless Apparition
 - Stillmoon Cavalier
 - Foxfire Oak [text only]
 - Suture Spirit [text only]
 - Swirling Spriggan [text only]
 - Lashwrithe  [text only]

 - B.F.M. (Big Furry Monster)

 - Various flavor texts are formatted incorrectly, e.g., those of:
  - Steamflogger Boss
  - Angus Mackenzie
  - Chub Toad
  - Mesa Chicken
  - Woodland Druid
  - Fool's Tome
  - Phosphorescent Feast (Future Sight)
  - A general description of this problem seems to be that italicization is
    only applied to the first line/cardtextbox of each piece of flavor text,
    even though there are some instances where it should be done otherwise.

 - Incorrectly transcribed flavor texts:
  - Steamflogger Boss
  - Invasion Plans
  - Pariah (Urza's Saga)
  - Greed (Legends, Fourth Edition, & Fifth Edition, the last two being solely
    incorrect formatting)
  - Squee, Goblin Nabob

 - Cards with flavor text listed in Oracle but not with any actually printed on
   the card:
  - Shimmering Wings (Tenth Edition)
  - Paladin en-Vec (Tenth Edition)
  - Pariah (Tenth Edition)

- Problems with the text spoilers only:
 - Reminder text and ability words aren't italicized.
 - Snow mana is represented as "{S}i}" (except for the first {S} in the text of
   Frost Raptor, which is simply "{S}i".)
 - Some Unhinged cards (and possibly others?) run consecutive mana symbols
   together, e.g., "{1B}" or "{WW}".
 - The following cards have their names listed incorrectly:
  - Valor - as "XXValor (Valor)" (Timeshifted printing only)
  - Call of the Herd - as "XXCall of the Herd (Call of the Herd)" (Timeshifted
    printing only)
  - Ærathi Berserker - as "rathi Berserker (Ærathi Berserker)"
  - Altar of Dementia - as "Altar Of Dementia (Altar of Dementia)"
  - Knight of Dawn - as "Knight Of Dawn (Knight of Dawn)"
  - The same problem applies to a lesser degree on the corresponding individual
    card details pages, where the unparenthesized names are shown in the large
    heading and the parenthesized names are listed in the "Name:" field.
